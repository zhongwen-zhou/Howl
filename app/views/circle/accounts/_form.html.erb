<%= simple_form_for [:circle, @group, @activity, @account], :validate => true do |f| %>
  <%= f.input :sum, label: "金额" %>
  <%= f.input :io_type, label: "收支类型", :as => :select, :collection => Category::IO_TYPE, :label_method => :last, :value_method => :first, :include_blank => false %>  
  <% unless @activity.present? %>
    <%= f.input :visable_status, label: "可见性", :as => :select, :include_blank => false, collection: Activity::VISABLE_STATUS, :label_method => :last, :value_method => :first %>
    <%= f.input :paid_user_id, label: "付款人", :as => :select, collection: @group.users, :label_method => :nick_name, :value_method => :id, :include_blank => false %>

    <div class="field">
        <ul id="genre_tab" class="nav nav-tabs">
          <li class="active"><a href="#category_type" val="Category" data-toggle="tab">类别帐务</a></li>
          <li><a href="#budget_type" val="Budget" data-toggle="tab">预算帐务</a></li>
          <li><a href="#activity_type" val="Activity" data-toggle="tab">活动帐务</a></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="category_type">
            <%= f.input :genre_id, label: false, :as => :grouped_select, :collection => Category.top_categories, :group_method => :children, :label_method => :name, :value_method => :id, :include_blank => false %>    
          </div>
          <div class="tab-pane" id="budget_type">
            <%= f.input :genre_id, label: false, :as => :select, :collection => @budgets, :label_method => :name, :value_method => :id, :include_blank => false %>            
          </div>   
          <div class="tab-pane" id="activity_type">
            <%= f.input :genre_id, label: false, :as => :select, :collection => @activities, :label_method => :subject, :value_method => :id, :include_blank => false %>             
          </div>             
        </div>
        <%= f.hidden_field(:genre_type, :value => 'Category') %>
    </div>   

  <% else %>
    <%= f.input :paid_user_id, label: "付款人", :as => :select, collection: @activity.users, :label_method => :nick_name, :value_method => :id, :include_blank => false %>
  <% end %>
  <%= f.input :remark, :as => :text, label: "备注", :input_html => {:rows => 5, :cols =>25} %>
  <%= f.button :submit, :value => "记起" %>
<% end %>

<script type="text/javascript">
  $(document).ready(function(){
    $('#genre_type').tab('show');
    $('a[data-toggle="tab"]').on('shown', function (e) {
      $('#account_genre_type').attr('value',$(e.target).attr('val'))
    });
  })
</script>